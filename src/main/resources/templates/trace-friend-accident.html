<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Spring Boot Thymeleaf Hello World Example</title>
    <link rel="stylesheet" th:href="@{main.css}"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

    <link th:href="@{jquery-3.5.1.min.js}"></link>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDDJZKw9mlX49vr0vkw4jd7xj2HuVPmCuw&callback=initMap">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
            crossorigin="anonymous"></script>

    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
</head>

<body>
<main role="main" class="container">

    <div id="map" style="width:90%; height: 500px; margin-left: auto; margin-right: auto"></div>

    <div class="col-md-6">
        <script th:inline="javascript">
            var marker;
            /*<![CDATA[*/
            var accidentObj = /*[[${accident}]]*/ 'default';
            /*]]>*/

            let accidentLatitude = parseFloat(accidentObj.lat);
            let accidentLongitute = parseFloat(accidentObj.lon);
            let hospitalLatitude = parseFloat(accidentObj.hospital.lat);
            let hospitalLongitute = parseFloat(accidentObj.hospital.lon);

            function initMap() {
                const map = new google.maps.Map(document.getElementById("map"), {
                    zoom: 14,
                    center: {lat: accidentLatitude, lng: accidentLongitute},
                    mapTypeId: "terrain",
                });
                marker = new google.maps.Marker({
                    position: {
                        lat: accidentLatitude,
                        lng: accidentLongitute
                    },
                    map,
                    title: "Hello World!",
                });

                const directionCoordinates = [
                    {lat: accidentLatitude, lng: accidentLongitute},
                    {lat: hospitalLatitude, lng: hospitalLongitute},
                ];
                const accidentToHospitalPath = new google.maps.Polyline({
                    path: directionCoordinates,
                    geodesic: true,
                    strokeColor: "#FF0000",
                    strokeOpacity: 1.0,
                    strokeWeight: 2,
                });
                accidentToHospitalPath.setMap(map);

                const hospitalCircle = new google.maps.Circle({
                    strokeColor: "#51cb18",
                    strokeOpacity: 0.8,
                    strokeWeight: 1,
                    fillColor: "#51cb18",
                    fillOpacity: 0.35,
                    map,
                    center: {lat: hospitalLatitude, lng: hospitalLongitute},
                    radius: 80,
                });

                const accidentCircle = new google.maps.Circle({
                    strokeColor: "#FF0000",
                    strokeOpacity: 0.8,
                    strokeWeight: 1,
                    fillColor: "#FF0000",
                    fillOpacity: 0.35,
                    map,
                    center: {lat: accidentLatitude, lng: accidentLongitute},
                    radius: 100,
                });
            }
        </script>
    </div>
</main>
</body>
<style type="text/css">
    #map {
        height: 100%;
    }

    /* Optional: Makes the sample page fill the window. */
    html,
    body {
        height: 100%;
        margin: 0;
        padding: 0;
    }
</style>
</html>
