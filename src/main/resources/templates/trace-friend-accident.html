<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Spring Boot Thymeleaf Hello World Example</title>
    <link rel="stylesheet" th:href="@{main.css}"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

    <link th:href="@{jquery-3.5.1.min.js}"></link>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDDJZKw9mlX49vr0vkw4jd7xj2HuVPmCuw&callback=initMap">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
            crossorigin="anonymous"></script>

    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
</head>

<body>
<main role="main" class="container">
    <div class="starter-template">

        <label class="checkbox-inline">
            <input type="checkbox" onchange="savePaisa(this)" checked data-toggle="toggle"> Save paisa
        </label>

        <h1>Spring Boot Web Thymeleaf Example</h1>

        <span class="greeting-id">The ID is </span>
        <span class="greeting-content">The lon is </span>
    </div>
    <div id="map" style="width:80%; height: 350px; margin-left: auto; margin-right: auto"></div>
    <div class="col-md-6">

        <script th:inline="javascript">

            var map;
            var marker;
            /*<![CDATA[*/
            var accidentObj = /*[[${accident}]]*/ 'default';
            /*]]>*/

            let latitude = parseFloat(accidentObj.lat);
            let longitute = parseFloat(accidentObj.lon);

            function initMap() {
                map = new google.maps.Map(document.getElementById("map"), {
                    center: {
                        lat: latitude,
                        lng: longitute
                    },
                    zoom: 15,
                });
                marker = new google.maps.Marker({
                    position: {
                        lat: latitude,
                        lng: longitute
                    },
                    map,
                    title: "Hello World!",
                });
            }

            var interval = setInterval(function () {
                getLatestLocation(accidentObj.userId);
            }, 9000);

            function getLatestLocation(userid) {
                var Location = {userId: userid};
                $.ajax({
                    url: "http://localhost:8085/api/location/get-location-by-userid",
                    type: "POST",
                    data: JSON.stringify(Location),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                }).then(function (data) {
                    $('.greeting-id').append(data.id);
                    $('.greeting-content').append(data.lon);

                    var newLatLng = new google.maps.LatLng(data.lat, data.lon);
                    marker.setPosition({
                        lat: parseFloat(data.lat),
                        lng: parseFloat(data.lon)
                    });
                });
            }

            function savePaisa(obj) {
                if ($(obj).prop("checked") == true) {
                    alert("paisa save karunga marte dam tak")
                    clearInterval(interval);
                } else {
                    alert("thura chala jay paisa 2 dino ka jindegi");
                    interval = setInterval(function () {
                        getLatestLocation(accidentObj.userId);
                    }, 9000);
                }
            }

        </script>
    </div>
</main>
</body>
<style type="text/css">
    #map {
        height: 100%;
    }

    /* Optional: Makes the sample page fill the window. */
    html,
    body {
        height: 100%;
        margin: 0;
        padding: 0;
    }
</style>
</html>
